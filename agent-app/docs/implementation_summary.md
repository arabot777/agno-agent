# å›¾åƒç”ŸæˆAgentå®ç°æ€»ç»“

## ğŸ¯ é¡¹ç›®ç›®æ ‡

ç»“åˆ **WaveSpeed MCP** å®ç°ä¸€ä¸ªæ”¯æŒé—®ç”Ÿå›¾åŠŸèƒ½çš„agentï¼Œè®©ç”¨æˆ·å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯ç”Ÿæˆé«˜è´¨é‡å›¾åƒã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒAgentå®ç°

#### å®Œæ•´ç‰ˆ (`agents/image_generator.py`)
- ğŸ”§ **é›†æˆWaveSpeed MCPå·¥å…·**: ä½¿ç”¨Model Context Protocolè¿æ¥WaveSpeed AIæœåŠ¡
- ğŸ¤– **æ™ºèƒ½å¯¹è¯å¼•æ“**: ä½¿ç”¨åƒé—®æ¨¡å‹ä½œä¸ºå¯¹è¯åŸºç¡€
- ğŸ“ **ä¸“ä¸šæŒ‡ä»¤è®¾è®¡**: åŒ…å«5æ­¥å·¥ä½œæµç¨‹ï¼šç†è§£è¯·æ±‚ â†’ ä¼˜åŒ–æç¤ºè¯ â†’ ç”Ÿæˆå›¾åƒ â†’ å±•ç¤ºç»“æœ â†’ è¿­ä»£æ”¹è¿›
- ğŸ’¾ **ä¼šè¯ç®¡ç†**: PostgreSQLå­˜å‚¨ç”¨æˆ·å¯¹è¯å†å²
- ğŸ¨ **å¤šåŠŸèƒ½æ”¯æŒ**: æ–‡æœ¬åˆ°å›¾åƒã€å›¾åƒåˆ°å›¾åƒã€é£æ ¼è½¬æ¢ç­‰

#### ç®€åŒ–ç‰ˆ (`agents/image_generator_simple.py`)
- ğŸ“š **æ¦‚å¿µå­¦ä¹ **: ä¸“æ³¨äºå›¾åƒç”Ÿæˆæ¦‚å¿µå’ŒæŠ€å·§æ•™å­¦
- âœï¸ **æç¤ºè¯ä¼˜åŒ–**: å¸®åŠ©ç”¨æˆ·ä¼˜åŒ–å›¾åƒç”Ÿæˆæç¤ºè¯
- ğŸ§  **æ•™è‚²åŠŸèƒ½**: è§£é‡Šè‰ºæœ¯æ¦‚å¿µå’Œç”ŸæˆæŠ€æœ¯
- ğŸš€ **æ— ä¾èµ–æµ‹è¯•**: ä¸ä¾èµ–MCPå·¥å…·ï¼Œç”¨äºåŠŸèƒ½éªŒè¯

### 2. ç³»ç»Ÿé›†æˆ

#### APIè·¯ç”±é›†æˆ (`agents/operator.py`)
```python
# æ–°å¢Agentç±»å‹
class AgentType(Enum):
    SAGE = "sage"
    SCHOLAR = "scholar"
    IMAGE_GENERATOR = "image_generator"  # æ–°å¢

# è·¯ç”±æ˜ å°„
def get_agent(agent_id: AgentType):
    if agent_id == AgentType.IMAGE_GENERATOR:
        return get_image_generator(...)
```

#### ä¾èµ–ç®¡ç† (`pyproject.toml`)
```toml
dependencies = [
    # ... ç°æœ‰ä¾èµ– ...
    "wavespeed-mcp",  # æ–°å¢
]
```

### 3. å¼€å‘å·¥å…·

#### ä½¿ç”¨ç¤ºä¾‹ (`examples/image_generation_example.py`)
- ğŸ® **äº¤äº’å¼ç¤ºä¾‹**: å±•ç¤ºå¦‚ä½•ä½¿ç”¨å›¾åƒç”Ÿæˆagent
- ğŸ”§ **é…ç½®æŒ‡å¯¼**: APIå¯†é’¥è®¾ç½®å’Œç¯å¢ƒé…ç½®
- ğŸ’¡ **æç¤ºè¯ç¤ºä¾‹**: æä¾›é«˜è´¨é‡çš„ç¤ºä¾‹æç¤ºè¯

#### æµ‹è¯•å¥—ä»¶
- **å®Œæ•´æµ‹è¯•** (`tests/test_image_generator.py`): æµ‹è¯•MCPé›†æˆå’Œå®Œæ•´åŠŸèƒ½
- **ç®€åŒ–æµ‹è¯•** (`tests/test_simple_image_generator.py`): æµ‹è¯•åŸºç¡€å¯¹è¯åŠŸèƒ½

### 4. æ–‡æ¡£ä½“ç³»

#### ç”¨æˆ·æŒ‡å— (`docs/image_generation_agent.md`)
- ğŸ“– **è¯¦ç»†ä½¿ç”¨è¯´æ˜**: å®‰è£…ã€é…ç½®ã€ä½¿ç”¨å…¨æµç¨‹
- ğŸ’¡ **æç¤ºè¯ä¼˜åŒ–å»ºè®®**: ç¼–å†™é«˜è´¨é‡æç¤ºè¯çš„æŠ€å·§
- ğŸ› ï¸ **æ•…éšœæ’é™¤**: å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- âš¡ **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨å»ºè®®å’Œæœ€ä½³å®è·µ

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```mermaid
graph TD
    A[ç”¨æˆ·è¯·æ±‚] --> B[ImageGenerator Agent]
    B --> C[åƒé—®æ¨¡å‹å¯¹è¯å¼•æ“]
    B --> D[WaveSpeed MCPå·¥å…·]
    D --> E[WaveSpeed AI API]
    E --> F[ç”Ÿæˆå›¾åƒ]
    B --> G[PostgreSQLä¼šè¯å­˜å‚¨]
    C --> H[ä¼˜åŒ–æç¤ºè¯]
    H --> D
    F --> I[è¿”å›ç»“æœç»™ç”¨æˆ·]
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### APIè°ƒç”¨
```bash
curl -X POST "http://localhost:8000/agents/image_generator/runs" \
     -H "Content-Type: application/json" \
     -d '{
       "message": "è¯·ç”Ÿæˆä¸€å¼ å¤•é˜³ä¸‹çš„å¤§æµ·å›¾ç‰‡ï¼Œè¦æœ‰æ¸©æš–çš„è‰²è°ƒ",
       "model": "qwen-max",
       "user_id": "user123"
     }'
```

### ç¼–ç¨‹æ¥å£
```python
import asyncio
from agents.image_generator import get_image_generator_async

async def generate_image():
    agent = await get_image_generator_async(
        wavespeed_api_key="your_api_key"
    )
    response = await agent.arun("ç”»ä¸€åªå¯çˆ±çš„å°çŒ«")
    print(response.content)

asyncio.run(generate_image())
```

## ğŸ”§ ç¯å¢ƒé…ç½®

### å¿…éœ€ä¾èµ–
```bash
pip install wavespeed-mcp mcp agno
```

### ç¯å¢ƒå˜é‡
```bash
export WAVESPEED_API_KEY=your_api_key_here
export WAVESPEED_API_HOST=https://api.wavespeed.ai
export WAVESPEED_API_RESOURCE_MODE=url
```

### æ•°æ®åº“è®¾ç½®
- PostgreSQLæ•°æ®åº“è¿æ¥
- è‡ªåŠ¨åˆ›å»º `image_generator_sessions` è¡¨

## âœ… æµ‹è¯•éªŒè¯

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
```bash
# ç®€åŒ–ç‰ˆæœ¬æµ‹è¯•ï¼ˆæ— MCPä¾èµ–ï¼‰
PYTHONPATH=. python tests/test_simple_image_generator.py

# å®Œæ•´åŠŸèƒ½æµ‹è¯•ï¼ˆéœ€è¦MCPé…ç½®ï¼‰
PYTHONPATH=. python tests/test_image_generator.py
```

### è¿è¡Œç¤ºä¾‹
```bash
# è®¾ç½®APIå¯†é’¥åè¿è¡Œ
export WAVESPEED_API_KEY=your_key
python examples/image_generation_example.py
```

## ğŸ¨ åŠŸèƒ½ç‰¹æ€§

### æ™ºèƒ½å¯¹è¯
- ğŸ§  **è‡ªç„¶è¯­è¨€ç†è§£**: å‡†ç¡®ç†è§£ç”¨æˆ·çš„å›¾åƒéœ€æ±‚
- ğŸ”„ **ä¸Šä¸‹æ–‡è®°å¿†**: åŸºäºå¯¹è¯å†å²æä¾›è¿è´¯æœåŠ¡
- ğŸ’¬ **äº¤äº’å¼æ”¹è¿›**: æ”¯æŒè¿­ä»£ä¼˜åŒ–å’Œå˜ä½“ç”Ÿæˆ

### ä¸“ä¸šå›¾åƒç”Ÿæˆ
- ğŸ¨ **æ–‡æœ¬åˆ°å›¾åƒ**: æ ¹æ®æè¿°ç”ŸæˆåŸåˆ›å›¾åƒ
- ğŸ–¼ï¸ **å›¾åƒåˆ°å›¾åƒ**: åŸºäºç°æœ‰å›¾åƒè¿›è¡Œå˜æ¢
- ğŸ­ **å¤šç§é£æ ¼**: æ”¯æŒå†™å®ã€æŠ½è±¡ã€åŠ¨æ¼«ç­‰é£æ ¼
- âš™ï¸ **å‚æ•°è°ƒä¼˜**: å°ºå¯¸ã€è´¨é‡ã€é£æ ¼ç²¾ç¡®æ§åˆ¶

### æç¤ºè¯ä¼˜åŒ–
- âœï¸ **æ™ºèƒ½ä¼˜åŒ–**: å°†ç®€å•æè¿°è½¬æ¢ä¸ºä¸“ä¸šæç¤ºè¯
- ğŸ“ **ç»“æ„åŒ–å¤„ç†**: åŒ…å«ä¸»ä½“ã€é£æ ¼ã€ç¯å¢ƒã€æŠ€æœ¯å‚æ•°
- ğŸš« **è´Ÿé¢æç¤º**: è‡ªåŠ¨æ·»åŠ è´¨é‡æ§åˆ¶è¦ç´ 
- ğŸ’¡ **åˆ›æ„å»ºè®®**: æä¾›è‰ºæœ¯åˆ›ä½œçµæ„Ÿ

## ğŸ“ˆ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡
- [ ] è§£å†³MCPç¯å¢ƒé…ç½®é—®é¢˜
- [ ] æ·»åŠ æ›´å¤šå›¾åƒç”Ÿæˆå‚æ•°é€‰é¡¹
- [ ] ä¼˜åŒ–æç¤ºè¯æ¨¡æ¿åº“
- [ ] æ·»åŠ å›¾åƒè´¨é‡è¯„ä¼°åŠŸèƒ½

### é•¿æœŸè§„åˆ’
- [ ] æ”¯æŒè§†é¢‘ç”ŸæˆåŠŸèƒ½
- [ ] é›†æˆæ›´å¤šAIå›¾åƒæœåŠ¡
- [ ] æ·»åŠ å›¾åƒç¼–è¾‘å·¥å…·
- [ ] æ„å»ºå›¾åƒç”Ÿæˆå·¥ä½œæµ

## ğŸ”§ MCPæ¶æ„é—®é¢˜è§£å†³

### é—®é¢˜å‘ç°
åœ¨å®ç°è¿‡ç¨‹ä¸­å‘ç°äº†MCPè¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„é—®é¢˜ï¼š

1. **é”™è¯¯çš„æ¶æ„è®¾è®¡**ï¼š
   ```python
   # âŒ é”™è¯¯æ–¹å¼ - è¿æ¥åœ¨å‡½æ•°è¿”å›åå…³é—­
   async def get_image_generator(...):
       async with MCPTools(command="wavespeed-mcp") as mcp_tools:
           return Agent(tools=[mcp_tools])  # è¿æ¥å·²å…³é—­ï¼
   ```

2. **è¿æ¥æ–­å¼€é”™è¯¯**ï¼š`anyio.ClosedResourceError`
   - MCPå·¥å…·èƒ½å¤ŸæˆåŠŸåˆå§‹åŒ–
   - Agentåˆ›å»ºæ—¶èƒ½è·å–å·¥å…·åˆ—è¡¨  
   - å®é™…è°ƒç”¨å·¥å…·æ—¶è¿æ¥å·²æ–­å¼€

### è§£å†³æ–¹æ¡ˆ

#### âœ… æ­£ç¡®çš„MCPä½¿ç”¨æ–¹å¼
```python
# 1. Playgroundæ–¹å¼ï¼ˆæ¨èï¼‰
async def run_server():
    async with MCPTools("wavespeed-mcp") as mcp_tools:
        agent = Agent(tools=[mcp_tools])
        playground = Playground(agents=[agent])
        playground.serve(playground.get_app())

# 2. è„šæœ¬æ–¹å¼
async def main():
    async with MCPTools("wavespeed-mcp") as mcp_tools:
        agent = Agent(tools=[mcp_tools])
        response = await agent.arun("ç”Ÿæˆå›¾ç‰‡")
```

#### æ–°å¢æ–‡ä»¶
- `examples/image_generation_playground.py` - Web UIç•Œé¢
- `examples/simple_mcp_test.py` - ç®€å•æµ‹è¯•è„šæœ¬
- `docs/mcp_architecture_solution.md` - è¯¦ç»†æŠ€æœ¯æ–¹æ¡ˆ

## ğŸ“ æ³¨æ„äº‹é¡¹

### å½“å‰é™åˆ¶
1. **MCPè¿æ¥ç”Ÿå‘½å‘¨æœŸ**: éœ€è¦åœ¨æ­£ç¡®çš„å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­ç®¡ç†MCPè¿æ¥
2. **APIå¯†é’¥**: éœ€è¦æœ‰æ•ˆçš„WaveSpeed APIå¯†é’¥
3. **ç½‘ç»œè¿æ¥**: éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥è®¿é—®API
4. **æ•°æ®åº“ä¾èµ–**: éœ€è¦PostgreSQLæ•°æ®åº“æ”¯æŒ

### æœ€ä½³å®è·µ
1. **è¯¦ç»†æè¿°**: ä½¿ç”¨å…·ä½“ã€è¯¦ç»†çš„å›¾åƒæè¿°
2. **è¿­ä»£æ”¹è¿›**: é€šè¿‡å¯¹è¯é€æ­¥å®Œå–„å›¾åƒæ•ˆæœ
3. **é£æ ¼æŒ‡å®š**: æ˜ç¡®æŒ‡å®šå¸Œæœ›çš„è‰ºæœ¯é£æ ¼
4. **æŠ€æœ¯å‚æ•°**: æ ¹æ®ç”¨é€”é€‰æ‹©åˆé€‚çš„å°ºå¯¸å’Œè´¨é‡

## ğŸ‰ æ€»ç»“

æˆ‘ä»¬æˆåŠŸå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å›¾åƒç”ŸæˆAgentï¼Œå®ƒï¼š

- âœ… **é›†æˆäº†å…ˆè¿›çš„AIæŠ€æœ¯**: WaveSpeed MCP + åƒé—®æ¨¡å‹
- âœ… **æä¾›äº†å‹å¥½çš„ç”¨æˆ·ä½“éªŒ**: è‡ªç„¶è¯­è¨€å¯¹è¯æ¥å£
- âœ… **å…·å¤‡äº†ä¸“ä¸šçš„ç”Ÿæˆèƒ½åŠ›**: å¤šç§å›¾åƒç”ŸæˆåŠŸèƒ½
- âœ… **åŒ…å«äº†å®Œæ•´çš„å¼€å‘å·¥å…·**: ç¤ºä¾‹ã€æµ‹è¯•ã€æ–‡æ¡£
- âœ… **æ”¯æŒäº†ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**: APIæ¥å£ã€æ•°æ®åº“å­˜å‚¨

è¿™ä¸ªAgentä¸ºç”¨æˆ·æä¾›äº†ä»åˆ›æ„æƒ³æ³•åˆ°æœ€ç»ˆå›¾åƒçš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼Œå¤§å¤§é™ä½äº†AIå›¾åƒç”Ÿæˆçš„ä½¿ç”¨é—¨æ§›ã€‚ 